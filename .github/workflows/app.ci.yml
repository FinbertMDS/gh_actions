name: ğŸ” Verify GitHub Secrets Hash

on:
  push:
  workflow_dispatch: # hoáº·c push, PR tÃ¹y báº¡n

jobs:
  verify-secrets:
    runs-on: ubuntu-latest

    steps:
      - name: â¬ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Read and compare secret hashes
        run: |
          echo "ğŸ“„ Reading .secret-hash-check.txt..."

          while IFS='=' read -r key expected_hash || [[ -n "$key" ]]; do
            # Bá» qua dÃ²ng comment hoáº·c trá»‘ng
            [[ "$key" =~ ^#.*$ || -z "$key" ]] && continue

            # Láº¥y secret tá»« GitHub
            secret_value="${{ secrets[${key}] }}"

            # Kiá»ƒm tra náº¿u secret khÃ´ng Ä‘Æ°á»£c set
            if [[ -z "$secret_value" ]]; then
              echo "âš ï¸  Secret $key is not set in GitHub"
              continue
            fi

            # TÃ­nh actual hash
            actual_hash=$(echo -n "$secret_value" | shasum -a 256 | awk '{print $1}')

            # So sÃ¡nh
            if [[ "$expected_hash" == "$actual_hash" ]]; then
              echo "âœ… $key: TrÃ¹ng khá»›p"
            else
              echo "âŒ $key: KHÃ”NG khá»›p"
              echo "   Expected: $expected_hash"
              echo "   Actual  : $actual_hash"
            fi

          done < .secret-hash-check.txt
